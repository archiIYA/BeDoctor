<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BeDoctor | Profile Setup</title>

<link rel="icon" type="image/svg+xml" href="logo.svg">

<style>
:root{
  --bg:#0b0f1a;
  --card:#141a2a;
  --text:#f5f7ff;
  --muted:#aab2d5;
  --accent:#8b5cf6;
  --accent2:#ec4899;
  --radius:20px;
  --shadow:0 30px 80px rgba(0,0,0,.55);
  --glow:0 0 40px rgba(139,92,246,.35);
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:radial-gradient(circle at top,#1b2040,#0b0f1a);
  color:var(--text);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

body::before{
  content:"";
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle,rgba(236,72,153,.6) 1px,transparent 2px),
    radial-gradient(circle,rgba(139,92,246,.6) 1px,transparent 2px);
  background-size:140px 140px;
  opacity:.35;
  z-index:-1;
}

.card{
  width:100%;
  max-width:460px;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow),var(--glow);
  padding:32px;
  animation:fadeUp .8s ease forwards;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(30px)}
  to{opacity:1;transform:translateY(0)}
}

.logo{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:12px;
}

.logo img{width:44px}
.logo strong{font-size:20px}

h1{margin:8px 0;font-size:26px}
p{margin:0 0 20px;color:var(--muted);font-size:14.5px}

input,select{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  margin-bottom:12px;
  background:#1f2540;
  color:#fff;
  font-size:15px;
}

input::placeholder{color:#c7cbea}

small{
  display:block;
  margin:-6px 0 12px;
  font-size:12px;
  color:var(--muted);
}

button{
  width:100%;
  padding:14px;
  border-radius:16px;
  border:none;
  cursor:pointer;
  font-weight:900;
  font-size:16px;
  color:#fff;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  box-shadow:0 0 40px rgba(139,92,246,.45);
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.status{
  margin-top:14px;
  font-size:13px;
  font-weight:700;
  color:var(--muted);
}

.footer{
  margin-top:18px;
  text-align:center;
  color:var(--muted);
  font-weight:700;
}
</style>
</head>

<body>

<div class="card">

  <div class="logo">
    <img src="logo.svg">
    <strong>BeDoctor</strong>
  </div>

  <h1>ðŸ‘¤ Create your profile</h1>
  <p>Complete your personal information to continue.</p>

  <input id="firstName" placeholder="First name">
  <input id="lastName" placeholder="Last name">

  <input id="username" placeholder="Username (unique)">
  <small id="userHint">Only letters and numbers â€“ must be unique</small>

  <select id="university">
    <option value="">Select your university</option>
    <option value="Algiers">Algiers</option>
    <option value="Blida">Blida</option>
    <option value="Annaba">Annaba</option>
    <option value="Setif">Setif</option>
  </select>

  <button id="saveBtn">Save profile</button>

  <div class="status" id="status"></div>

  <div class="footer">dr iyad + dr ines</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  query,
  where,
  collection,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBFt5fRSInCvNsrVQfHVTGmsCWajD8jvPI",
  authDomain: "bedoctor-81569.firebaseapp.com",
  projectId: "bedoctor-81569",
  storageBucket: "bedoctor-81569.firebasestorage.app",
  messagingSenderId: "126611461186",
  appId: "1:126611461186:web:6755ff737156c3919d09db"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const statusEl = document.getElementById("status");
const saveBtn = document.getElementById("saveBtn");

let currentUser = null;

onAuthStateChanged(auth, async (user)=>{
  if(!user){
    window.location.href="login.html";
  }else{
    currentUser = user;
  }
});

async function isUsernameAvailable(username){
  const q = query(
    collection(db,"users"),
    where("username","==",username)
  );
  const snap = await getDocs(q);
  return snap.empty;
}

saveBtn.onclick = async ()=>{
  const firstName = firstNameInput.value = document.getElementById("firstName").value.trim();
  const lastName  = document.getElementById("lastName").value.trim();
  const username  = document.getElementById("username").value.trim().toLowerCase();
  const university= document.getElementById("university").value;

  if(!firstName || !lastName || !username || !university){
    statusEl.textContent = "âš ï¸ Please fill all fields.";
    return;
  }

  if(!/^[a-z0-9]+$/.test(username)){
    statusEl.textContent = "âŒ Username must contain only letters and numbers.";
    return;
  }

  saveBtn.disabled = true;
  statusEl.textContent = "â³ Checking username...";

  const available = await isUsernameAvailable(username);
  if(!available){
    statusEl.textContent = "âŒ Username already taken.";
    saveBtn.disabled = false;
    return;
  }

  statusEl.textContent = "â³ Saving profile...";

  await setDoc(doc(db,"users",currentUser.uid),{
    uid: currentUser.uid,
    email: currentUser.email || null,
    firstName,
    lastName,
    username,
    university,
    createdAt: new Date()
  });

  statusEl.textContent = "âœ… Profile saved successfully!";
  setTimeout(()=>window.location.href="dashboard.html",1200);
};
</script>

</body>
</html>

